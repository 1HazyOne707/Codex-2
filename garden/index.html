<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Garden</title>
  <style>
    html,body{height:100%;margin:0;background:#071015}
    canvas{display:block;width:100%;height:100%}
    .hud{position:fixed;inset:auto 12px 12px auto;background:#0b1417cc;border:1px solid #142a2f;color:#cfe;padding:8px 10px;border-radius:10px;font:12px/1.3 system-ui}
    a{color:#9fe}
  </style>
</head>
<body>
  <canvas id="c"></canvas>
  <div class="hud">Garden (private) Â· <a href="/api/me">status</a></div>
<script>
const el = document.getElementById('c');
const ctx = el.getContext('2d');
function fit(){ el.width = innerWidth*devicePixelRatio; el.height = innerHeight*devicePixelRatio; ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);}
addEventListener('resize',fit); fit();

async function loadSeed(){
  const r = await fetch('/api/seed', {headers:{'cache-control':'no-store'}});
  if(!r.ok){ ctx.fillStyle='#9aa'; ctx.fillText('No seed or not authorized', 20, 30); return {nodes:[],links:[]} }
  return r.json();
}
function draw(seed){
  ctx.clearRect(0,0,innerWidth,innerHeight);
  const nodes = seed.nodes||[];
  const links = seed.links||[];
  // links
  ctx.strokeStyle='rgba(120,210,190,0.25)';
  ctx.lineWidth=1.5;
  links.forEach(l=>{
    const a = nodes.find(n=>n.id===l.source)||nodes[l.source]|0;
    const b = nodes.find(n=>n.id===l.target)||nodes[l.target]|0;
    if(!a||!b) return;
    ctx.beginPath(); ctx.moveTo(a.x*innerWidth, a.y*innerHeight); ctx.lineTo(b.x*innerWidth, b.y*innerHeight); ctx.stroke();
  });
  // nodes
  nodes.forEach(n=>{
    const x=n.x*innerWidth, y=n.y*innerHeight;
    ctx.fillStyle='rgba(90,240,200,.9)';
    ctx.beginPath(); ctx.arc(x,y, 4+(n.weight||1)*.5, 0, Math.PI*2); ctx.fill();
  });
}
(async function main(){
  const seed = await loadSeed();
  draw(seed);
  // light heartbeat refresh
  setInterval(async()=>{ const s=await loadSeed(); draw(s); }, 4000);
})();
</script>
</body>
</html>
